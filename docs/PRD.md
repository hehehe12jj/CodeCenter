# CodeAgent Dashboard 产品需求文档 (PRD)

---

## 文档信息

| 项目 | 内容 |
|------|------|
| 产品名称 | CodeAgent Dashboard |
| 文档版本 | v1.0 |
| 创建日期 | 2026-01-29 |
| 产品负责人 | - |
| 状态 | 待评审 |

---

## 1. 概述

### 1.1 背景

随着 AI 编程助手（如 Claude Code）的普及，开发者经常需要在多个项目中并行进行对话式编程任务。当前存在以下痛点：

- **缺乏全局视图**：无法快速一览所有正在进行的会话状态
- **状态不透明**：不知道哪些会话在运行中、哪些在等待输入、哪些被阻塞
- **切换繁琐**：需要在多个终端窗口间频繁切换
- **遗漏提醒**：等待输入的会话可能被遗忘

### 1.2 产品定位

一个 **终端/TUI 会话管理驾驶舱**，作为所有 Code Agent（目前支持 Claude Code）的统一管理界面。

> 核心价值：一屏看遍所有项目进度，快速响应等待输入的会话

### 1.3 目标用户

- 多项目并行开发的开发者
- 经常使用 Claude Code/Gemini Code 等 AI 编程助手的工程师
- 需要管理多个 AI 编程会话的团队技术负责人

### 1.4 竞品分析

| 产品 | 定位 | 优势 | 不足 |
|------|------|------|------|
| Claude Code CLI | 单会话交互 | 功能完整 | 只能管理当前项目 |
| Cursor Tab | IDE 集成 | UI 友好 | 闭源、付费 |
| Continue VSCode 插件 | IDE 集成 | 免费 | 依赖 IDE |

**差异化机会**：纯终端场景的轻量级会话管理工具，专注多会话聚合视图

---

## 2. 用户故事

| 编号 | 角色 | 场景 | 目标 |
|------|------|------|------|
| US-01 | 开发者 | 多项目并行编码 | 一眼看到所有会话状态，快速识别需要关注的会话 |
| US-02 | 开发者 | 收到等待输入的会话提醒 | 快速响应，无需在多个终端窗口中查找 |
| US-03 | 开发者 | 想要继续某个会话 | 一键打开终端或弹窗继续对话 |
| US-04 | 开发者 | 会话完成需要归档 | 标记完成/归档，保持会话列表整洁 |
| US-05 | 开发者 | 需要新建会话 | 在管理界面直接启动新的 Claude Code 会话 |

---

## 3. 功能需求

### 3.1 功能列表

| 模块 | 功能 | 优先级 | 描述 |
|------|------|--------|------|
| 仪表盘 | 会话列表展示 | P0 | 展示所有活跃会话卡片 |
| 仪表盘 | 状态统计 | P0 | 显示运行中/等待输入/已完成的数量 |
| 仪表盘 | 状态徽章 | P0 | 区分四种状态并可视化 |
| 会话详情 | 快速接管对话 | P0 | 弹窗式对话界面直接输入 |
| 会话详情 | 打开终端 | P1 | 跳转到原始终端窗口 |
| 会话管理 | 标记完成 | P1 | 将会话标记为已完成状态 |
| 会话管理 | 归档历史 | P2 | 移至历史记录，保持列表整洁 |
| 会话管理 | 新建会话 | P2 | 直接在面板中启动新会话 |
| 系统 | 自动刷新 | P1 | 实时更新会话状态 |
| 系统 | 终端/TUI 交互 | P0 | 鼠标友好的终端界面 |

### 3.2 状态定义

| 状态 | 视觉标识 | 含义 | 触发条件 |
|------|----------|------|----------|
| 运行中 | 脉冲绿点 | Claude Code 正在执行任务 | 检测到工具调用/代码执行中 |
| 等待输入 | 黄色点 | 等待用户明确回复 | Claude Code 输出提示问题 |
| 已完成 | 蓝色点 | 会话已结束但未关闭 | 用户标记或检测到会话结束信号 |
| 执行阻塞 | 红色脉冲 | 代码执行/工具调用被阻塞 | 错误、超时、权限拒绝 |

### 3.3 数据字段

| 字段 | 类型 | 描述 | 来源 |
|------|------|------|------|
| session_id | string | 会话唯一标识 | 内部生成 |
| title | string | 会话标题 | 用户输入/摘要生成 |
| project_name | string | 项目名称 | 目录名 |
| project_path | string | 项目绝对路径 | 当前工作目录 |
| status | enum | 会话状态 | 检测 |
| start_time | datetime | 会话开始时间 | 启动时记录 |
| last_active | datetime | 最后活跃时间 | 每次交互更新 |
| summary | string | 最近消息摘要 | 截取最近一条 |
| agent_type | string | 代理类型 (claude/gemini) | 启动参数 |

---

## 4. 交互设计

### 4.1 界面布局

```
┌─────────────────────────────────────────────────────────────┐
│  ⟡ CodeAgent Dashboard                          [+ 新建] [↻] │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────┐    │
│  │ ● 2      ● 1       ● 3           最后更新: 10:32:45 │    │
│  │ 运行中   等待输入   已完成                          │    │
│  └─────────────────────────────────────────────────────┘    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐    │
│  │ 会话标题                            [等待输入]      │    │
│  │ backend-api                                         │    │
│  │ 开始: 10:15  最后活跃: 10:28                        │    │
│  │ /Users/hejj/projects/backend-api                    │    │
│  │                                                     │    │
│  │ "会话摘要内容..."                                    │    │
│  │ [继续对话] [打开终端] [标记完成]                    │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 用户流程

```
启动 Dashboard
      │
      ▼
┌─────────────────┐
│ 显示会话列表    │ ◄── 自动发现/读取记录
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
  查看状态   点击会话
    │         │
    ▼         ▼
┌─────────┐  ┌─────────────────┐
│ 统计栏  │  │ 弹窗对话 OR     │
│ 徽章    │  │ 打开终端        │
└─────────┘  └─────────────────┘
```

### 4.3 核心交互说明

#### 4.3.1 会话卡片交互

| 交互 | 触发 | 响应 |
|------|------|------|
| 悬停 | 鼠标移动到卡片 | 显示操作按钮 |
| 点击卡片主体 | 打开对话弹窗 | 显示历史消息和输入框 |
| 点击"打开终端" | 打开系统终端 | 切换到对应项目目录 |
| 点击"标记完成" | 状态变更 | 状态变为"已完成" |

#### 4.3.2 对话弹窗交互

```
┌─────────────────────────────────┐
│ 会话标题           [project]  ✕ │
├─────────────────────────────────┤
│                                 │
│  ┌──┐                          │
│  │👤│ 用户消息                  │
│  └──┘ 内容...                   │
│                                 │
│                          ┌──┐   │
│                     AI消息 │🤖│   │
│                     内容...└──┘   │
│                                 │
├─────────────────────────────────┤
│ [ 输入消息...            ] [发送]│
└─────────────────────────────────┘
```

- **发送**：Enter 发送，Shift+Enter 换行
- **关闭**：点击右上角 X 或点击遮罩层

---

## 5. 技术方案

### 5.1 系统架构

详见 [技术设计文档](./TECHNICAL_DESIGN.md)。

架构概览：

```
┌─────────────────────────────────────────────────────────────┐
│                    CodeAgent Dashboard                      │
├─────────────────────────────────────────────────────────────┤
│  Presentation Layer (React + TailwindCSS)                   │
│  ├── Dashboard UI (玻璃态设计系统)                          │
│  ├── Session Card Component                                 │
│  ├── Chat Modal Component                                   │
│  └── Status Badge Component                                 │
├─────────────────────────────────────────────────────────────┤
│  Service Layer                                              │
│  ├── Session Manager                                        │
│  ├── Status Detector                                        │
│  ├── Process Monitor                                        │
│  └── CLI Wrapper                                            │
├─────────────────────────────────────────────────────────────┤
│  Data Layer (本地 JSON 存储)                                │
└─────────────────────────────────────────────────────────────┘
```

### 5.2 设计系统

**视觉风格**：极简深色、玻璃态（Glassmorphism）、微交互

| 设计元素 | 规范 |
|---------|------|
| 背景层级 | #0d0d0f → #16161a → #1c1c22 |
| 卡片样式 | 半透明 rgba(28,28,34,0.6) + backdrop-filter: blur(20px) |
| 边框 | 1px solid rgba(255,255,255,0.08) |
| 圆角 | 卡片 16px，按钮 10px，输入框 10px |
| 文字层级 | 纯白 100% → 60% → 40% 透明度 |
| 动画 | 缓动函数 cubic-bezier(0.4, 0, 0.2, 1)，时长 200-300ms |

详见原型文件 `prototype.html`。

### 5.3 数据存储

```
~/.codeagent/
├── sessions.json      # 会话记录
├── projects.json      # 项目配置
└── cache/
    └── status.json    # 实时状态缓存
```

**数据格式概览**（详见技术设计文档）：

```json
{
  "sessions": [{
    "id": "uuid",
    "title": "实现用户认证模块",
    "project_name": "backend-api",
    "project_path": "/Users/hejj/projects/backend-api",
    "status": "waiting_input",
    "start_time": "2026-01-29T10:15:00Z",
    "last_active": "2026-01-29T10:28:00Z",
    "summary": "已完成登录接口的JWT token生成...",
    "agent_type": "claude",
    "archived": false
  }]
}
```

### 5.4 技术选型

| 层级 | 技术 | 说明 |
|------|------|------|
| 前端框架 | React + TailwindCSS | 组件化开发，支持设计系统 |
| 桌面封装 | Tauri | 轻量、跨平台、终端友好 |
| 数据存储 | JSON 文件 | 本地存储，无需服务端 |
| 状态检测 | CLI 包装层 | 包装 `claude` 命令，自动记录状态 |

详细技术方案见 [TECHNICAL_DESIGN.md](./TECHNICAL_DESIGN.md)。

---

## 6. 里程碑规划

### Phase 1: MVP（最小可行产品）

**目标**：核心功能可用，验证产品方向

| 任务 | 交付物 | 预估工时 |
|------|--------|----------|
| 包装层命令实现 | `cc` 命令 | 2 天 |
| 数据存储层 | JSON 读写模块 | 1 天 |
| 基础 UI 框架 | Dashboard 框架 | 2 天 |
| 会话卡片组件 | 完整组件 | 1 天 |
| 对话弹窗 | 完整功能 | 1 天 |
| **小计** | | **7 天** |

### Phase 2: 完善功能

| 任务 | 交付物 | 预估工时 |
|------|--------|----------|
| 状态自动检测 | 状态检测模块 | 2 天 |
| 终端集成 | 打开终端功能 | 1 天 |
| 自动刷新 | 实时更新机制 | 1 天 |
| 归档功能 | 历史记录管理 | 1 天 |
| **小计** | | **5 天** |

### Phase 3: 优化体验

| 任务 | 交付物 | 预估工时 |
|------|--------|----------|
| 多 Agent 支持 | Gemini Code 等 | 2 天 |
| 快捷键支持 | 键盘导航 | 1 天 |
| 主题切换 | 深色/浅色主题 | 1 天 |
| 导出功能 | 会话导出 | 1 天 |
| **小计** | | **5 天** |

---

## 7. 验收标准

### 功能验收

- [ ] 启动 Dashboard 能看到所有活跃会话
- [ ] 状态徽章正确显示四种状态
- [ ] 点击会话卡片能打开对话弹窗
- [ ] 在弹窗中输入能发送消息
- [ ] 点击"打开终端"能跳转到正确目录
- [ ] 标记完成后面板状态更新
- [ ] 刷新按钮能更新状态

### 质量验收

- [ ] 界面加载时间 < 2s
- [ ] 状态更新延迟 < 5s
- [ ] 支持 20+ 并发会话
- [ ] 界面布局在 1366x768 分辨率下正常显示

---

## 8. 附录

### 8.1 术语表

| 术语 | 定义 |
|------|------|
| 会话 (Session) | 一次 Claude Code 对话实例 |
| 活跃会话 | 未标记为归档的会话 |
| 包装层 | 封装原始命令的中间层 |
| 状态检测 | 识别会话当前运行状态的技术 |

### 8.2 参考资料

- [Claude Code 官方文档](https://code.claude.com/docs/zh-CN/setup)
- [Tauri 官方文档](https://tauri.app/)
- [TailwindCSS 官方文档](https://tailwindcss.com/)

### 8.3 原型文件

交互原型见：`prototype.html`

---

## 9. 变更记录

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|----------|------|
| v1.1 | 2026-01-29 | 设计升级：采用极简玻璃态风格，更新界面布局图示，精简技术方案章节（详细技术方案移至独立文档） | - |
| v1.0 | 2026-01-29 | 初始版本 | - |
